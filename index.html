<!DOCTYPE HTML>
<HEAD>
<title>Mobile Standby</title>
<meta charset="UTF-8" />
<META HTTP-EQUIV="Pragma" CONTENT="no-cache"/>
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black" />
<link rel="stylesheet"  href="jquery.mobile.min.css"/>
<script type="text/javascript" src="js/sjcl.js"></script>
<script src="js/settings.js" type="text/javascript"></script>
<script src="js/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="js/jquery.mobile-1.3.1.min.js" type="text/javascript"></script>
<script type="text/javascript" src="js/shake.js"></script>
<script src="phonegap.js"></script>
<style>
.logo_image {
  text-align: center;
  margin-left:0 auto;
  margin-right:0 auto;
}
</style>
<script type="text/javascript">
var sw,sh;
var netstate = '';

// Phonegap stuff, not applicable for regular browser use
document.addEventListener("deviceready", onDeviceReady, false);
 function onDeviceReady() {
		checkConnection();
		window.setInterval('checkConnection();',5000);  // display connection every 5 secs.. 
 }

$(document).ready(function() 
{
	sw = $(this).width();
	sh = $(this).height();
	Validate(Validated);
});
function Validated(xml) {
	var res = $(xml).find("string").text();
	if (res=='True') {
		generic_ajax('standby.asmx/GetCurrentStandbyNow',null,gotCurrentStandby);
		$('#footer').html(getStatusInfo());
		window.addEventListener('shake', shakeEventDidOccur, false);
	}
	else {
		$('#menu').hide();
		Redirect(0);
	}
	wsbusy = false;

}
function shakeEventDidOccur () 
{
	generic_ajax('standby.asmx/GetCurrentStandbyNow',null,gotCurrentStandby);
	$('#footer').html(getStatusInfo());
	checkConnection();
}
function gotCurrentStandby(xml) {
	var found_objects = $(xml).find("Duty");
	found_objects.each(function() 
	{
		current_year = $(this).find('CurrentYear').text();
		current_week = $(this).find('CurrentWeek').text();
		var b = $(this).find('BossName').text();
		var r = $(this).find('ReplaceName').text();
		if (r!='') 
			b = r + ' vervangt ' +b;
		var spac = ' - ';	
		if ( sw < 400 ) {
			
			spac = '<br>';	
		}
		$('#header2').html('OTR Standby '  + spac +  b + spac + current_year + ' week '  + current_week  );
		doLayout();
	});
    wsbusy = false;

}
function load(url) {
	location = url;
}
function doLayout() {
	$('#spacer').height( $('#header2').height()-15 );
}
</script>
</HEAD>
<body>
<div  data-theme="a" data-role="header" data-position="fixed" data-tap-toggle="false">
	<div>
		<h1 id="topbar" class='ui-title' data-theme="a" role='heading' aria-level='1'><div id="header2">OTR Standby</div>
		<img id="netstatus" src="gap/net/inv.gif" class="ui-btn-right" >
		</h1>
	</div>
</div>
<div id="menu" data-role="content" data-theme="b">
	<div id="spacer">&nbsp;</div>
	<div class="logo_image"><img class="logo_image" width="300px" src="images/tank.png"  alt="Image Header" ></div>
	<a data-icon="grid" data-role="button" onclick="load('now.html');" href="#" >Huidige Dienst</a>
	<a data-icon="grid" data-role="button" onclick="load('last10.html');" href="#" >Laatste 10 Calls</a>
	<a data-icon="grid" data-role="button" onclick="load('locked.html');" href="#" >Unlock user(s)</a>
	<a data-icon="grid" data-role="button" onclick="load('settings.html');" href="#" >Instellingen</a>
	<a data-icon="grid" data-role="button" onclick="load('debug.html');" href="#" >Debug info</a>
</div>
<div  data-theme="a" data-role="content" data-position="fixed" data-tap-toggle="false">
<div id="bottombar" calss="ui-title" data-theme="a" role="heading"></div>
<div id="footer">--</div>
</div>


</body>
</html>
